<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Dictionary</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .hidden { display: none; }
    .tabs button { margin-right: 10px; padding: 6px 12px; }
    .entry { border: 1px solid #ccc; padding: 8px; margin-bottom: 8px; }
    .gray { color: gray; font-style: italic; }
    canvas { max-width: 400px; margin-top: 20px; }
  </style>
</head>
<body>

  <h1>Interactive Dictionary</h1>
  <div class="tabs">
    <button onclick="showTab('dictionary')">Dictionary</button>
    <button onclick="showTab('admin')">Admin Panel</button>
    <button onclick="showTab('analysis')">Analysis</button>
    <button onclick="loadCSV()">Import CSV</button>
  </div>

  <div id="dictionary" class="tab">
    <h2>Dictionary</h2>
    <div id="dictionaryList"></div>
  </div>

  <div id="admin" class="tab hidden">
    <h2>Admin Panel</h2>
    <div id="adminList"></div>
  </div>

  <div id="analysis" class="tab hidden">
    <h2>Analysis</h2>
    <!-- Placeholder for charts -->
    <div id="mockChart">[Pie chart placeholder]</div>
    <div id="topicsRaw">[Word cloud placeholder]</div>
  </div>

  <script>
    const sampleCSV = `word,meaning,etymology,topic
apple,a fruit,germanic,daily life
tractor,a farm vehicle,slavic,agriculture
joke,something funny,romance,humor`;

    let entries = [];

    // Initialize the dictionary with some mock entries
    const mockEntries = [
      { word: "apple", meaning: "a fruit", etymology: "germanic", topic: "daily life", status: "none", editedVersion: "", isEditing: false },
      { word: "tractor", meaning: "a farm vehicle", etymology: "slavic", topic: "agriculture", status: "none", editedVersion: "", isEditing: false },
      { word: "joke", meaning: "something funny", etymology: "romance", topic: "humor", status: "none", editedVersion: "", isEditing: false }
    ];

    // Set the mock entries initially
    entries = mockEntries;

    // Render the dictionary when the page loads
    renderDictionary();

    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(el => el.classList.add('hidden'));
      document.getElementById(tab).classList.remove('hidden');
      if (tab === 'dictionary') renderDictionary();
      if (tab === 'admin') renderAdmin();
      if (tab === 'analysis') renderAnalysis();
    }

    function loadCSV() {
      const lines = sampleCSV.trim().split('\n');
      const headers = lines[0].split(',');
      entries = lines.slice(1).map(line => {
        const parts = line.split(',');
        const obj = {};
        headers.forEach((h, i) => obj[h] = parts[i]);
        obj.status = 'none';
        obj.editedVersion = '';
        return obj;
      });
      alert('Sample CSV loaded!');
      renderDictionary();
    }

    function renderDictionary() {
      const list = document.getElementById('dictionaryList');
      list.innerHTML = '';
      entries.forEach((entry, i) => {
        const div = document.createElement('div');
        div.className = 'entry';
        
        // If the entry is being edited, show the input field, else show the regular text
        if (entry.isEditing) {
          div.innerHTML = `
            <strong>${entry.word}</strong>. <input type="text" id="editMeaning${i}" value="${entry.editedVersion || entry.meaning}" />
            <button onclick="saveEdit(${i})">Save</button>
            <button onclick="cancelEdit(${i})">Cancel</button>
          `;
        } else {
          div.innerHTML = `
            <strong>${entry.word}</strong>. ${entry.meaning}
            ${entry.status === 'pending' ? `<div class="gray">Proposed: ${entry.editedVersion}</div>` : ''}
            <br><button onclick="editEntry(${i})">Edit</button>
          `;
        }

        list.appendChild(div);
      });
    }

    function renderAdmin() {
      const list = document.getElementById('adminList');
      list.innerHTML = '';
      entries.forEach((entry, i) => {
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `
          <strong>${entry.word}</strong>. ${entry.meaning}
          ${entry.status === 'pending' ? `<div class="gray">Proposed: ${entry.editedVersion}</div>` : ''}
          <br>
          <button onclick="editEntry(${i})">Edit</button>
          ${entry.status === 'pending' ? `
            <button onclick="confirmEdit(${i})">Confirm</button>
            <button onclick="rejectEdit(${i})">Reject</button>
          ` : ''}
        `;
        list.appendChild(div);
      });
    }

    function renderAnalysis() {
      // Placeholder for mock charts
      document.getElementById('mockChart').innerHTML = '[Pie chart placeholder]';
      document.getElementById('topicsRaw').innerHTML = '[Word cloud placeholder]';
    }

    function editEntry(i) {
      entries[i].isEditing = true;
      renderDictionary(); // Re-render dictionary to show editable field
    }

    function saveEdit(i) {
      const newMeaning = document.getElementById(`editMeaning${i}`).value;
      if (newMeaning && newMeaning !== entries[i].meaning) {
        entries[i].editedVersion = newMeaning;
        entries[i].status = 'pending';
        entries[i].isEditing = false;
        renderDictionary();
        renderAdmin();
      }
    }

    function cancelEdit(i) {
      entries[i].isEditing = false;
      renderDictionary();
    }

    function confirmEdit(i) {
      entries[i].meaning = entries[i].editedVersion;
      entries[i].editedVersion = '';
      entries[i].status = 'confirmed';
      entries[i].isEditing = false;
      renderAdmin();
      renderDictionary();
    }

    function rejectEdit(i) {
      entries[i].editedVersion = '';
      entries[i].status = 'none';
      entries[i].isEditing = false;
      renderAdmin();
      renderDictionary();
    }

  </script>
</body>
</html>
